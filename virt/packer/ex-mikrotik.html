<!DOCTYPE html>
<html>
<head>
<title>ex-mikrotik.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="packer-lab">Packer lab</h1>
<h2 id="building-mikrotik-routeros-version-77-image">Building Mikrotik RouterOS version 7.7 image</h2>
<ol>
<li>
<p>open Command prompt</p>
</li>
<li>
<p>cd path to packer directory eg Go to Packer foler on workshop content provided on USB drive.</p>
<pre class="hljs"><code><div>C:&gt; cd C:\workshop\packer\
C:\workshop\packer&gt;
</div></code></pre>
</li>
<li>
<p>go into mikrotik folder</p>
<pre class="hljs"><code><div>C:\workshop\packer&gt; cd mikrotik
C:\workshop\packer\mikrotik&gt;
</div></code></pre>
</li>
<li>
<p>verify packer build config using <code>packer validate ros.json</code> and see output similar to following</p>
<pre class="hljs"><code><div>C:\workshop\packer&gt; packer validate ros.json
The Configuration is valid.
</div></code></pre>
</li>
<li>
<p>build image usinf <code>packer build ros.json</code> and should see output similar to following</p>
<pre class="hljs"><code><div>C:\workshop\packer&gt; packer build ros.json
 virtualbox-iso: output will be in this color.

 ==&gt; virtualbox-iso: Retrieving ISO
 ==&gt; virtualbox-iso: Trying ../../iso/mikrotik-7.7.iso
 ==&gt; virtualbox-iso: Trying ../../iso/mikrotik-7.7.iso?checksum=md5%3Aefb65169264696dbdc002f99b9b88b1b
 ==&gt; virtualbox-iso: ../../iso/mikrotik-7.7.iso?checksum=md5%3Aefb65169264696dbdc002f99b9b88b1b =&gt; /Users/chatur/Downloads/web/npNOG/Automation-Ansible/packer/iso/mikrotik-7.7.iso
 ==&gt; virtualbox-iso: Creating virtual machine...
 ==&gt; virtualbox-iso: Creating hard drive output/virtualbox-iso/mikrotik-7.7/mikrotik-7.7.vdi with size 128 MiB...
 ==&gt; virtualbox-iso: Mounting ISOs...
     virtualbox-iso: Mounting boot ISO...
 ==&gt; virtualbox-iso: Creating forwarded port mapping for communicator (SSH, WinRM, etc) (host port 3467)
 ==&gt; virtualbox-iso: Executing custom VBoxManage commands...
     virtualbox-iso: Executing: modifyvm mikrotik-7.7 --memory 128
     virtualbox-iso: Executing: modifyvm mikrotik-7.7 --cpus 1
     virtualbox-iso: Executing: modifyvm mikrotik-7.7 --acpi on
     virtualbox-iso: Executing: modifyvm mikrotik-7.7 --ioapic on
     virtualbox-iso: Executing: modifyvm mikrotik-7.7 --hpet on
     virtualbox-iso: Executing: modifyvm mikrotik-7.7 --rtcuseutc on
     virtualbox-iso: Executing: modifyvm mikrotik-7.7 --pae on
     virtualbox-iso: Executing: modifyvm mikrotik-7.7 --hwvirtex on
     virtualbox-iso: Executing: modifyvm mikrotik-7.7 --vtxvpid on
     virtualbox-iso: Executing: modifyvm mikrotik-7.7 --vtxux on
     virtualbox-iso: Executing: modifyvm mikrotik-7.7 --nic1 nat
     virtualbox-iso: Executing: modifyvm mikrotik-7.7 --nic2 intnet --intnet2 port1
     virtualbox-iso: Executing: modifyvm mikrotik-7.7 --nic3 intnet --intnet3 port2
     virtualbox-iso: Executing: modifyvm mikrotik-7.7 --nic4 intnet --intnet4 port3
     virtualbox-iso: Executing: modifyvm mikrotik-7.7 --nat-localhostreachable1 on
 ==&gt; virtualbox-iso: Starting the virtual machine...
     virtualbox-iso: The VM will be run headless, without a GUI. If you want to
     virtualbox-iso: view the screen of the VM, connect via VRDP without a password to
     virtualbox-iso: rdp://127.0.0.1:5916
 ==&gt; virtualbox-iso: Waiting 15s for boot...
 ==&gt; virtualbox-iso: Typing the boot command...
 ==&gt; virtualbox-iso: Using SSH communicator to connect: 127.0.0.1
 ==&gt; virtualbox-iso: Waiting for SSH to become available...
 ==&gt; virtualbox-iso: Connected to SSH!
 ==&gt; virtualbox-iso: Provisioning with shell script: scripts/defconf.rsc
     virtualbox-iso: #line 1
     virtualbox-iso: /interface bridge add name=bridge comment=defconf disabled=no
     virtualbox-iso: #line 2
     virtualbox-iso: /interface bridge port add bridge=bridge comment=defconf interface=ether2
     virtualbox-iso: #line 3
     virtualbox-iso: /interface bridge port add bridge=bridge comment=defconf interface=ether3
     virtualbox-iso: #line 4
     virtualbox-iso: /interface bridge port add bridge=bridge comment=defconf interface=ether4
     virtualbox-iso: #line 5
     virtualbox-iso: /ip address add address=192.168.88.1/24 comment=defconf interface=bridge network=192.168.88.0
     virtualbox-iso: #line 6
     virtualbox-iso: /user add name=vagrant password=vagrant group=full
     virtualbox-iso: #line 7
     virtualbox-iso: /tool fetch url=&quot;https://raw.githubusercontent.com/hashicorp/vagrant/master/keys/vagrant.pub&quot; mode=https
     virtualbox-iso:   status: connecting
     virtualbox-iso:
     virtualbox-iso:       status: finished
     virtualbox-iso:   downloaded: 0KiB
     virtualbox-iso:        total: 0KiB
     virtualbox-iso:     duration: 0s
     virtualbox-iso:
     virtualbox-iso: #line 8
     virtualbox-iso: /user ssh-keys import user=vagrant public-key-file=vagrant.pub
 ==&gt; virtualbox-iso: Gracefully halting virtual machine...
 ==&gt; virtualbox-iso: Preparing to export machine...
     virtualbox-iso: Deleting forwarded port mapping for the communicator (SSH, WinRM, etc) (host port 3467)
 ==&gt; virtualbox-iso: Exporting virtual machine...
     virtualbox-iso: Executing: export mikrotik-7.7 --output output/virtualbox-iso/mikrotik-7.7/mikrotik-7.7.ovf
 ==&gt; virtualbox-iso: Cleaning up floppy disk...
 ==&gt; virtualbox-iso: Deregistering and deleting VM...
 ==&gt; virtualbox-iso: Running post-processor: vagrant
 ==&gt; virtualbox-iso (vagrant): Creating a dummy Vagrant box to ensure the host system can create one correctly
 ==&gt; virtualbox-iso (vagrant): Creating Vagrant box for 'virtualbox' provider
     virtualbox-iso (vagrant): Copying from artifact: output/virtualbox-iso/mikrotik-7.7/mikrotik-7.7-disk001.vmdk
     virtualbox-iso (vagrant): Copying from artifact: output/virtualbox-iso/mikrotik-7.7/mikrotik-7.7.ovf
     virtualbox-iso (vagrant): Renaming the OVF to box.ovf...
     virtualbox-iso (vagrant): Using custom Vagrantfile: Vagrantfile.template
     virtualbox-iso (vagrant): Compressing: Vagrantfile
     virtualbox-iso (vagrant): Compressing: box.ovf
     virtualbox-iso (vagrant): Compressing: metadata.json
     virtualbox-iso (vagrant): Compressing: mikrotik-7.7-disk001.vmdk
 Build 'virtualbox-iso' finished after 2 minutes 54 seconds.

 ==&gt; Wait completed after 2 minutes 54 seconds

 ==&gt; Builds finished. The artifacts of successful builds are:
 --&gt; virtualbox-iso: 'virtualbox' provider box: ../../box/mikrotik-routeros-7.7.box
</div></code></pre>
</li>
<li>
<p>Now go to workshop content folder, there you see new folder named <code>box</code></p>
</li>
<li>
<p>Inside <code>box</code> foler you will find <code>Mikrotik ROS</code> image you just created</p>
</li>
<li>
<p>now we will import this into <code>vagrant</code> and test it.</p>
<pre class="hljs"><code><div>C:\workshop&gt; vagrant box add box/mikrotik-routeros-7.7.box --name mikrotik-routeros-7.7
==&gt; box: Box file was not detected as metadata. Adding it directly...
==&gt; box: Adding box 'mikrotik-routeros-7.7' (v0) for provider: 
    box: Unpacking necessary files from: file://C:\workshop\box\mikrotik-routeros-7.7.box
==&gt; box: Successfully added box 'mikrotik-routeros-7.7' (v0) for 'virtualbox'!
</div></code></pre>
</li>
<li>
<p>now initialize vagrant box and test it</p>
<pre class="hljs"><code><div>C:\workshop&gt; cd vagrant 
C:\workshop\vagrant&gt; mkdir mikrotik
C:\workshop\vagrant&gt; cd mikrotik

C:\workshop\vagrant\mikrotik&gt;vagrant init mikrotik-routeros-7.7

A `Vagrantfile` has been placed in this directory. You are now
ready to `vagrant up` your first virtual environment! Please read
the comments in the Vagrantfile as well as documentation on
`vagrantup.com` for more information on using Vagrant.
</div></code></pre>
</li>
<li>
<p>start vagrant box</p>
<pre class="hljs"><code><div>C:\workshop\vagrant\mikrotik&gt; vagrant up

Bringing machine 'default' up with 'virtualbox' provider...
==&gt; default: Importing base box 'mikrotik-routeros-7.7'...
==&gt; default: Matching MAC address for NAT networking...
==&gt; default: Setting the name of the VM: vagrant_default_1675848542546_17610
==&gt; default: Clearing any previously set network interfaces...
==&gt; default: Preparing network interfaces based on configuration...
    default: Adapter 1: nat
    default: Adapter 2: hostonly
    default: Adapter 3: intnet
    default: Adapter 4: intnet
==&gt; default: Forwarding ports...
    default: 22 (guest) =&gt; 2222 (host) (adapter 1)
==&gt; default: Running 'pre-boot' VM customizations...
==&gt; default: Booting VM...
==&gt; default: Waiting for machine to boot. This may take a few minutes...
    default: SSH address: 127.0.0.1:2222
    default: SSH username: vagrant
    default: SSH auth method: private key
The configured shell (config.ssh.shell) is invalid and unable
to properly execute commands. The most common cause for this is
using a shell that is unavailable on the system. Please verify
you're using the full path to the shell and that the shell is
executable by the SSH user.
</div></code></pre>
</li>
<li>
<p>ssh into mikrotik vagrant box</p>
<pre class="hljs"><code><div>C:\workshop\vagrant\mikrotik&gt; vagrant ssh

MMM      MMM       KKK                          TTTTTTTTTTT      KKK
MMMM    MMMM       KKK                          TTTTTTTTTTT      KKK
MMM MMMM MMM  III  KKK  KKK  RRRRRR     OOOOOO      TTT     III  KKK  KKK
MMM  MM  MMM  III  KKKKK     RRR  RRR  OOO  OOO     TTT     III  KKKKK
MMM      MMM  III  KKK KKK   RRRRRR    OOO  OOO     TTT     III  KKK KKK
MMM      MMM  III  KKK  KKK  RRR  RRR   OOOOOO      TTT     III  KKK  KKK

MikroTik RouterOS 7.7 (c) 1999-2023       https://www.mikrotik.com/


ROUTER HAS NO SOFTWARE KEY
----------------------------
You have 23h33m to configure the router to be remotely accessible,
and to enter the key by pasting it in a Telnet window or in Winbox.
Turn off the device to stop the timer.
See www.mikrotik.com/key for more details.

Current installation &quot;software ID&quot;: WLIM-CM73
Please press &quot;Enter&quot; to continue!


[vagrant@MikroTik] &gt; 
[vagrant@MikroTik] &gt; quit
Connection to 127.0.0.1 closed.

</div></code></pre>
</li>
<li>
<p>destroy mikrotik box</p>
<pre class="hljs"><code><div>C:\workshop\vagrant\mikrotik&gt; vagrant destroy
    default: Are you sure you want to destroy the 'default' VM? [y/N] y
==&gt; default: Forcing shutdown of VM...
==&gt; default: Destroying VM and associated drives...
</div></code></pre>
</li>
</ol>

</body>
</html>
